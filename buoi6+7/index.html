<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản Lý Sinh Viên</title>
    <style>
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        table, th, td { border: 1px solid black; padding: 8px; text-align: left; }
        #thongBao { color: green; margin-top: 10px; }
    </style>
</head>
<body>

<h2>Quản Lý Sinh Viên</h2>

<form id="formSV">
    <label>Mã SV: <input type="text" id="maSV"></label>
    <label>Họ Tên: <input type="text" id="hoTen"></label>
    <label>Email: <input type="text" id="email"></label>
    <button type="button" id="btnThem">Thêm sinh viên</button>
    <button type="button" id="btnCapNhat" style="display:none;">Cập nhật</button>
</form>

<div id="thongBao"></div>

<table id="bangSinhVien">
    <thead>
        <tr>
            <th>Mã SV</th>
            <th>Họ Tên</th>
            <th>Email</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    let editingRow = null; // Lưu trữ dòng đang chỉnh sửa

    // Tiết 1: Gắn sự kiện cho nút Thêm
    document.getElementById("btnThem").addEventListener("click", function () {
        themSinhVien();
    });

    // Hàm hiển thị thông báo
    function thongBao(msg) {
        const tb = document.getElementById("thongBao");
        tb.innerText = msg;
        setTimeout(() => tb.innerText = "", 3000);
    }

    // Tiết 2 + 5: Thêm dòng mới + Validation
    function themSinhVien() {
        let maSV = document.getElementById("maSV").value;
        let hoTen = document.getElementById("hoTen").value;
        let email = document.getElementById("email").value;

        // Validation
        if (maSV.trim() === "" || hoTen.trim() === "" || email.trim() === "") {
            alert("Vui lòng nhập đầy đủ thông tin");
            return;
        }
        let regexEmail = /^\S+@\S+\.\S+$/;
        if (!regexEmail.test(email)) {
            alert("Email không hợp lệ");
            return;
        }

        let table = document.getElementById("bangSinhVien").getElementsByTagName("tbody")[0];
        let newRow = table.insertRow();
        newRow.insertCell(0).innerText = maSV;
        newRow.insertCell(1).innerText = hoTen;
        newRow.insertCell(2).innerText = email;
        newRow.insertCell(3).innerHTML = `
            <button onclick="suaDong(this)">Sửa</button>
            <button onclick="xoaDong(this)">Xóa</button>
        `;

        thongBao("Thêm sinh viên thành công!");
        document.getElementById("formSV").reset();
    }

    // Tiết 4: Xóa dòng
    function xoaDong(btn) {
        if (confirm("Bạn có chắc chắn muốn xóa?")) {
            btn.parentElement.parentElement.remove();
            thongBao("Xóa thành công!");
        }
    }

    // Tiết 6: Chỉnh sửa dòng
    function suaDong(btn) {
        editingRow = btn.parentElement.parentElement;
        document.getElementById("maSV").value = editingRow.cells[0].innerText;
        document.getElementById("hoTen").value = editingRow.cells[1].innerText;
        document.getElementById("email").value = editingRow.cells[2].innerText;

        document.getElementById("btnThem").style.display = "none";
        document.getElementById("btnCapNhat").style.display = "inline-block";
    }

    document.getElementById("btnCapNhat").addEventListener("click", function () {
        let maSV = document.getElementById("maSV").value;
        let hoTen = document.getElementById("hoTen").value;
        let email = document.getElementById("email").value;

        // Validation
        if (maSV.trim() === "" || hoTen.trim() === "" || email.trim() === "") {
            alert("Vui lòng nhập đầy đủ thông tin");
            return;
        }
        let regexEmail = /^\S+@\S+\.\S+$/;
        if (!regexEmail.test(email)) {
            alert("Email không hợp lệ");
            return;
        }

        // Cập nhật dữ liệu
        editingRow.cells[0].innerText = maSV;
        editingRow.cells[1].innerText = hoTen;
        editingRow.cells[2].innerText = email;

        thongBao("Cập nhật thành công!");
        document.getElementById("formSV").reset();
        document.getElementById("btnThem").style.display = "inline-block";
        document.getElementById("btnCapNhat").style.display = "none";
        editingRow = null;
    });
</script>

</body>
</html>
